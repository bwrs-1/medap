# 実装計画 v0.1 - タスクバックログ

## 優先度の見方
- **P0**: MVP必須（これがないとリリース不可）
- **P1**: MVP推奨（あると体験が大幅に向上）
- **P2**: v1以降（MVP後に追加）

---

## 1. Infra（インフラ）

### P0-1: Google Sheets準備
- **完了条件**: 4シート（varieties/containers/container_varieties/audit_log）を作成し、サンプルデータ3件投入
- **担当**: PM
- **見積**: 30分

### P0-2: Google Cloud Projectセットアップ
- **完了条件**: プロジェクト作成、Billing有効化、Cloud Run API有効化
- **担当**: Tech Lead
- **見積**: 15分

### P0-3: サービスアカウント作成
- **完了条件**: Sheets API読み書き権限を持つサービスアカウント作成、JSON鍵をダウンロード
- **担当**: Tech Lead
- **見積**: 15分

### P1-1: Cloud Run環境構築
- **完了条件**: Node.js/Python環境でHello Worldをデプロイし、HTTPSでアクセス可能
- **担当**: Backend
- **見積**: 1時間

---

## 2. Backend（API）

### P0-4: プロジェクト初期化
- **完了条件**: Node.js/Express（or Python/Flask）プロジェクト作成、Google Sheets APIクライアント導入
- **担当**: Backend
- **見積**: 30分

### P0-5: Sheets CRUD基盤実装
- **完了条件**: Sheetsへの読み書き・楽観ロック処理を共通関数化
- **担当**: Backend
- **見積**: 2時間

### P0-6: 品種API実装（GET /varieties, GET /varieties/{id}）
- **完了条件**: 一覧・詳細取得が動作、検索パラメータ対応
- **担当**: Backend
- **見積**: 1.5時間

### P0-7: 品種API実装（POST/PUT/DELETE）
- **完了条件**: 作成・更新・削除が動作、楽観ロックエラーを返す
- **担当**: Backend
- **見積**: 2時間

### P0-8: 容器API実装（全CRUD）
- **完了条件**: 容器の作成・取得・更新・削除が動作
- **担当**: Backend
- **見積**: 2時間

### P0-9: 容器×品種紐付けAPI実装
- **完了条件**: POST/PUT/DELETE /containers/{id}/varieties が動作
- **担当**: Backend
- **見積**: 1.5時間

### P0-10: 認証実装（JWT発行・検証）
- **完了条件**: Google OAuth IDトークンを検証してJWT発行、ミドルウェアで認証チェック
- **担当**: Backend
- **見積**: 3時間

### P0-11: 権限チェック実装
- **完了条件**: Viewer/Editor/Adminの権限チェックをミドルウェア化
- **担当**: Backend
- **見積**: 1.5時間

### P1-2: 監査ログ実装
- **完了条件**: CREATE/UPDATE/DELETE時にaudit_logシートに記録
- **担当**: Backend
- **見積**: 2時間

### P1-3: レート制限実装
- **完了条件**: 100req/分を超えたら429を返す
- **担当**: Backend
- **見積**: 1時間

---

## 3. iOS（SwiftUI）

### P0-12: Xcodeプロジェクト作成
- **完了条件**: SwiftUIプロジェクト作成、Bundle IDを`com.yourname.medaka`に設定
- **担当**: iOS
- **見積**: 15分

### P0-13: API通信基盤実装
- **完了条件**: URLSessionラッパー作成、JWT保存・送信処理
- **担当**: iOS
- **見積**: 2時間

### P0-14: データモデル定義
- **完了条件**: Variety/Container/ContainerVariety構造体をCodableで定義
- **担当**: iOS
- **見積**: 30分

### P0-15: 品種一覧画面実装
- **完了条件**: VarietyListView実装、API取得・検索・グリッド表示
- **担当**: iOS
- **見積**: 3時間

### P0-16: 品種詳細画面実装
- **完了条件**: VarietyDetailView実装、画像・説明・難易度表示
- **担当**: iOS
- **見積**: 2時間

### P0-17: 品種編集画面実装
- **完了条件**: VarietyEditView実装、Form入力・保存処理
- **担当**: iOS
- **見積**: 3時間

### P0-18: 容器一覧画面実装
- **完了条件**: ContainerListView実装、API取得・List表示
- **担当**: iOS
- **見積**: 2時間

### P0-19: 容器詳細画面実装
- **完了条件**: ContainerDetailView実装、飼育中品種リスト表示
- **担当**: iOS
- **見積**: 2.5時間

### P0-20: 容器編集画面実装
- **完了条件**: ContainerEditView実装、Form入力・保存処理
- **担当**: iOS
- **見積**: 2時間

### P0-21: 品種紐付け画面実装
- **完了条件**: AddVarietyToContainerView実装、Picker選択・個体数入力
- **担当**: iOS
- **見積**: 2時間

### P0-22: 設定画面実装
- **完了条件**: SettingsView実装、ユーザー情報・ログアウト
- **担当**: iOS
- **見積**: 1.5時間

### P0-23: Google OAuth実装
- **完了条件**: GoogleSignInライブラリ導入、ログイン→JWT取得フロー
- **担当**: iOS
- **見積**: 3時間

### P1-4: オフラインキャッシュ実装
- **完了条件**: 取得データをUserDefaultsに保存、オフライン時に表示
- **担当**: iOS
- **見積**: 2.5時間

### P1-5: アクセシビリティ対応
- **完了条件**: VoiceOverラベル設定、Dynamic Type対応、コントラストチェック
- **担当**: iOS
- **見積**: 2時間

### P1-6: エラーハンドリング強化
- **完了条件**: 409 Conflict時に「他のユーザーが更新しました」アラート表示
- **担当**: iOS
- **見積**: 1.5時間

---

## 4. Test（テスト）

### P0-24: Backend APIテスト
- **完了条件**: 各エンドポイントの正常系・異常系をPostmanで確認
- **担当**: Backend
- **見積**: 2時間

### P0-25: iOS手動テスト
- **完了条件**: 全画面を実機で操作し、CRUD動作を確認
- **担当**: iOS
- **見積**: 1.5時間

### P1-7: Backend単体テスト
- **完了条件**: Jest/Pytestで楽観ロック・権限チェックのテスト追加
- **担当**: Backend
- **見積**: 3時間

### P1-8: iOS UIテスト
- **完了条件**: XCUITestで主要フローの自動テスト追加
- **担当**: iOS
- **見積**: 3時間

---

## 5. Release（リリース）

### P0-26: AltStore用IPA作成
- **完了条件**: Xcodeでアーカイブ→IPAエクスポート（Development署名）
- **担当**: iOS
- **見積**: 30分

### P0-27: AltStoreでインストールテスト
- **完了条件**: 実機にインストールし、起動・ログイン・CRUD動作確認
- **担当**: iOS
- **見積**: 30分

### P1-9: README作成
- **完了条件**: インストール手順・使い方をREADME.mdに記載
- **担当**: PM
- **見積**: 1時間

---

## タスク総見積
- **P0（MVP必須）**: 約40時間
- **P1（MVP推奨）**: 約17時間
- **合計**: 約57時間

---

## 推奨実装順序

### Week 1: Infra + Backend基盤
1. P0-1 → P0-2 → P0-3 → P1-1
2. P0-4 → P0-5 → P0-6 → P0-7

### Week 2: Backend完成 + iOS基盤
3. P0-8 → P0-9 → P0-10 → P0-11
4. P0-12 → P0-13 → P0-14

### Week 3: iOS画面実装
5. P0-15 → P0-16 → P0-17
6. P0-18 → P0-19 → P0-20 → P0-21

### Week 4: 認証 + テスト + リリース
7. P0-22 → P0-23
8. P0-24 → P0-25
9. P0-26 → P0-27

### Week 5: 仕上げ（P1タスク）
10. P1-2 → P1-4 → P1-5 → P1-6

---

**作成日**: 2026-01-08  
**バージョン**: 0.1  
**次回更新**: スプリント開始時
